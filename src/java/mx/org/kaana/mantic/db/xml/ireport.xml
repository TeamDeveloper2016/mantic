<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
    Relación de consultas para la generacion de reportes para MANTIC
-->
<process>
  <model>
  </model>
  <dml>
		<unit id="VistaReportesOrdenesComprasDto">
			<select id="reporteOrden">
				select
					tc_mantic_ordenes_compras.id_orden_compra as id_key,
					tc_mantic_ordenes_compras.id_empresa,  
				  tc_mantic_empresas.clave as clave_empresa,  
				  tc_mantic_empresas.nombre as nombre_empresa,
				  tc_mantic_empresas.titulo as titulo_empresa,				        
				  tc_mantic_personas.rfc rfc_contacto,
					tc_mantic_ordenes_compras.consecutivo,  
					tc_mantic_proveedores.id_proveedor,  
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_ordenes_compras.total,
				  tc_mantic_ordenes_estatus.nombre as estatus,
					tc_mantic_ordenes_compras.id_orden_estatus,
					tc_mantic_ordenes_compras.registro as registro_orden_compra,
					tc_mantic_ordenes_compras.entrega_estimada,
					tc_mantic_ordenes_compras.impuestos,					
					tc_mantic_ordenes_compras.sub_total,
					tc_mantic_ordenes_compras.descuentos,					
					tc_mantic_ordenes_compras.observaciones,
					telefono.valor as contacto_telefono,
					correo.valor as contacto_email,					
					tc_mantic_ordenes_detalles.*,
					concat(tc_mantic_personas.nombres, ' ' , tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as contacto,
				  concat(agentes.nombres, ' ' , agentes.paterno, ' ', agentes.materno) as agente,	
				  tc_mantic_domicilios.calle as proveedor_calle,
					tc_mantic_domicilios.asentamiento as proveedor_colonia,
					upper(tc_janal_localidades.descripcion) as localidad,
					telefono_proveedor.valor as proveedor_telefono,
					correo_proveedor.valor as proveedor_email,									
					domicilio_almacen.asentamiento as almacen_colonia,
					domicilio_almacen.calle as almacen_calle,
					upper(localidad_almacen.descripcion) almacen_localidad,
					telefono_almacen.valor as almacen_telefono,
					correo_almacen.valor as almacen_email,
					tc_mantic_articulos.nombre as articulo,
					tc_mantic_articulos.precio								
				from 
					tc_mantic_ordenes_compras
				inner join 
					tr_mantic_proveedor_pago on tc_mantic_ordenes_compras.id_proveedor_pago= tr_mantic_proveedor_pago.id_proveedor_pago
				inner join 
					tc_mantic_proveedores on tr_mantic_proveedor_pago.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
					tr_mantic_proveedor_domicilio on tc_mantic_proveedores.id_proveedor = tr_mantic_proveedor_domicilio.id_proveedor and tr_mantic_proveedor_domicilio.id_principal=1
				inner join 
					tc_mantic_domicilios on tr_mantic_proveedor_domicilio.id_domicilio = tc_mantic_domicilios.id_domicilio
				inner join 
					tc_janal_localidades on tc_mantic_domicilios.id_localidad = tc_janal_localidades.id_localidad
				left join 
					tr_mantic_proveedor_tipo_contacto telefono_proveedor on tc_mantic_proveedores.id_proveedor = telefono_proveedor.id_proveedor and telefono_proveedor.id_tipo_contacto=1
				left join 
					tr_mantic_proveedor_tipo_contacto correo_proveedor on tc_mantic_proveedores.id_proveedor = correo_proveedor.id_proveedor and correo_proveedor.id_tipo_contacto=9
				left join 
					tr_mantic_proveedor_agente on tc_mantic_proveedores.id_proveedor = tr_mantic_proveedor_agente.id_proveedor and tr_mantic_proveedor_agente.id_principal=1
				left join 
					tc_mantic_personas agentes on tr_mantic_proveedor_agente.id_agente= agentes.id_persona
				inner join 
					tc_mantic_almacenes on tc_mantic_ordenes_compras.id_almacen = tc_mantic_almacenes.id_almacen
				left join 
					tr_mantic_almacen_domicilio on tc_mantic_almacenes.id_almacen = tr_mantic_almacen_domicilio.id_almacen and tr_mantic_almacen_domicilio.id_principal=1
				left join 
					tc_mantic_domicilios domicilio_almacen on tr_mantic_almacen_domicilio.id_domicilio = domicilio_almacen.id_domicilio
				left join 
					tc_janal_localidades localidad_almacen on domicilio_almacen.id_localidad = localidad_almacen.id_localidad
				left join 
					tr_mantic_almacen_tipo_contacto telefono_almacen on tc_mantic_almacenes.id_almacen = telefono_almacen.id_almacen and telefono_almacen.id_tipo_contacto=1
				left join 
					tr_mantic_almacen_tipo_contacto correo_almacen on tc_mantic_almacenes.id_almacen = correo_almacen.id_almacen and correo_almacen.id_tipo_contacto=9
				inner join 
					tc_mantic_ordenes_detalles on tc_mantic_ordenes_compras.id_orden_compra= tc_mantic_ordenes_detalles.id_orden_compra
				inner join 
					tc_mantic_articulos on tc_mantic_ordenes_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_ordenes_compras.id_empresa= tc_mantic_empresas.id_empresa
				left join 
					tc_mantic_personas on tc_mantic_empresas.id_responsable = tc_mantic_personas.id_persona
				left join 
					tr_mantic_persona_tipo_contacto telefono on tc_mantic_personas.id_persona = telefono.id_persona and telefono.id_tipo_contacto=1
				left join 
					tr_mantic_persona_tipo_contacto correo on telefono.id_persona = correo.id_persona and correo.id_tipo_contacto=9
				inner join 
					tc_mantic_ordenes_estatus on tc_mantic_ordenes_compras.id_orden_estatus= tc_mantic_ordenes_estatus.id_orden_estatus
				where
          tc_mantic_ordenes_compras.id_orden_compra= {idOrdenCompra}									
			</select>
      <select id="ordenDetalle">
        select
          tc_mantic_ordenes_compras.id_orden_compra as id_key,
          tc_mantic_ordenes_compras.id_empresa,
          tc_mantic_empresas.clave as clave_empresa,
          tc_mantic_empresas.nombre as nombre_empresa,
          tc_mantic_empresas.titulo as titulo_empresa,
          empresa_telefonos.valor empresa_telefono,
          upper(empresa_email.valor) empresa_email,
          responsable_empresa.rfc rfc_contacto,
          tc_mantic_ordenes_compras.consecutivo,
          tc_mantic_proveedores.id_proveedor,
          tc_mantic_proveedores.razon_social as proveedor,
          tc_mantic_proveedores.rfc as proveedor_rfc,
          tc_mantic_ordenes_compras.total total_orden,
          tc_mantic_ordenes_estatus.nombre as estatus,
          tc_mantic_ordenes_compras.id_orden_estatus,
          tc_mantic_ordenes_compras.registro as registro_orden_compra,
          tc_mantic_ordenes_compras.entrega_estimada,
          tc_mantic_ordenes_compras.impuestos impuestos_orden,
          tc_mantic_ordenes_compras.sub_total sub_total_orden,
          tc_mantic_ordenes_compras.descuentos descuentos_orden,
          tc_mantic_ordenes_compras.observaciones,
          telefono.valor as contacto_telefono,
          correo.valor as contacto_email,
          tc_mantic_ordenes_detalles.*,
          concat(responsable_empresa.nombres, ' ' , responsable_empresa.paterno, ' ', responsable_empresa.materno) as contacto, 
          concat(agentes.nombres, ' ' ,  agentes.paterno, ' ',agentes.materno) as agente,
          domicilio_proveedor.calle as proveedor_calle,
          domicilio_proveedor.asentamiento as proveedor_colonia,
          domicilio_proveedor.codigo_postal as proveedor_cp,
          concat(replace(replace(upper(municipio_proveedor.descripcion),char(10),' '),char(13),' '),', ' ,upper(entidad_proveedor.descripcion),', ',upper(pais_proveedor.descripcion)) as proveedor_region,
          upper(localidad_proveedor.descripcion) as proveedor_localidad,
          telefono_proveedor.valor as proveedor_telefono,
          correo_proveedor.valor as proveedor_email,
          domicilio_almacen.asentamiento as almacen_colonia,
          domicilio_almacen.calle as almacen_calle,
          domicilio_almacen.codigo_postal as almacen_cp,
          concat(replace(replace(upper(municipio_almacen.descripcion),char(10),' '),char(13),' '),', ' ,upper(entidad_almacen.descripcion),', ',upper(pais_almacen.descripcion)) as almacen_region,
          upper(localidad_almacen.descripcion) almacen_localidad,
          telefono_almacen.valor as almacen_telefono,
          correo_almacen.valor as almacen_email,
          domicilio_empresa.calle as empresa_calle,
          domicilio_empresa.asentamiento as empresa_colonia,
          domicilio_empresa.codigo_postal as empresa_cp,
          concat(replace(replace(upper(municipio_empresa.descripcion),char(10),' '),char(13),' '),', ' ,upper(entidad_empresa.descripcion),', ',upper(pais_empresa.descripcion)) as empresa_region,
          upper(localidad_empresa.descripcion) as empresa_localidad,
          tc_mantic_articulos.nombre as articulo,
          tc_mantic_articulos.precio            												
				from 
					tc_mantic_ordenes_compras
				inner join 
					tr_mantic_proveedor_pago on tc_mantic_ordenes_compras.id_proveedor_pago= tr_mantic_proveedor_pago.id_proveedor_pago
				inner join 
					tc_mantic_proveedores on tr_mantic_proveedor_pago.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
					tr_mantic_proveedor_domicilio on tc_mantic_proveedores.id_proveedor = tr_mantic_proveedor_domicilio.id_proveedor and tr_mantic_proveedor_domicilio.id_principal=1
				inner join 
					tc_mantic_domicilios  domicilio_proveedor on tr_mantic_proveedor_domicilio.id_domicilio = domicilio_proveedor.id_domicilio
				inner join 
					tc_janal_localidades localidad_proveedor on domicilio_proveedor.id_localidad = localidad_proveedor.id_localidad
        inner join
          tc_janal_municipios municipio_proveedor on localidad_proveedor.id_municipio = municipio_proveedor.id_municipio
        inner join
					tc_janal_entidades  entidad_proveedor on municipio_proveedor.id_entidad = entidad_proveedor.id_entidad
				inner join
					tc_janal_paises  pais_proveedor on entidad_proveedor.id_pais = pais_proveedor.id_pais
				left join 
					tr_mantic_proveedor_tipo_contacto telefono_proveedor on tc_mantic_proveedores.id_proveedor = telefono_proveedor.id_proveedor and telefono_proveedor.id_tipo_contacto=1
				left join 
					tr_mantic_proveedor_tipo_contacto correo_proveedor on tc_mantic_proveedores.id_proveedor = correo_proveedor.id_proveedor and correo_proveedor.id_tipo_contacto=9
				left join 
					tr_mantic_proveedor_agente on tc_mantic_proveedores.id_proveedor = tr_mantic_proveedor_agente.id_proveedor and tr_mantic_proveedor_agente.id_principal=1
				left join 
					tc_mantic_personas agentes on tr_mantic_proveedor_agente.id_agente= agentes.id_persona
				inner join 
					tc_mantic_almacenes on tc_mantic_ordenes_compras.id_almacen = tc_mantic_almacenes.id_almacen
				left join 
					tr_mantic_almacen_domicilio on tc_mantic_almacenes.id_almacen = tr_mantic_almacen_domicilio.id_almacen and tr_mantic_almacen_domicilio.id_principal=1
				left join 
					tc_mantic_domicilios domicilio_almacen on tr_mantic_almacen_domicilio.id_domicilio = domicilio_almacen.id_domicilio
				left join 
					tc_janal_localidades localidad_almacen on domicilio_almacen.id_localidad = localidad_almacen.id_localidad
				left join
          tc_janal_municipios municipio_almacen on localidad_almacen.id_municipio = municipio_almacen.id_municipio
        left join
					tc_janal_entidades  entidad_almacen on municipio_almacen.id_entidad = entidad_almacen.id_entidad
				left join
					tc_janal_paises  pais_almacen on entidad_almacen.id_pais = pais_almacen.id_pais
				left join 
					tr_mantic_almacen_tipo_contacto telefono_almacen on tc_mantic_almacenes.id_almacen = telefono_almacen.id_almacen and telefono_almacen.id_tipo_contacto=1
				left join 
					tr_mantic_almacen_tipo_contacto correo_almacen on tc_mantic_almacenes.id_almacen = correo_almacen.id_almacen and correo_almacen.id_tipo_contacto=9
				inner join 
					tc_mantic_ordenes_detalles on tc_mantic_ordenes_compras.id_orden_compra= tc_mantic_ordenes_detalles.id_orden_compra
				inner join 
					tc_mantic_articulos on tc_mantic_ordenes_detalles.id_articulo = tc_mantic_articulos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_ordenes_compras.id_empresa= tc_mantic_empresas.id_empresa
				inner join 
					tr_mantic_empresa_tipo_contacto empresa_telefonos on tc_mantic_empresas.id_empresa = empresa_telefonos.id_empresa and empresa_telefonos.id_tipo_contacto = 1
				inner join 
					tr_mantic_empresa_tipo_contacto empresa_email on tc_mantic_empresas.id_empresa = empresa_email.id_empresa and empresa_email.id_tipo_contacto = 9
				inner join 
					tc_mantic_domicilios  domicilio_empresa on tr_mantic_proveedor_domicilio.id_domicilio = domicilio_empresa.id_domicilio
				inner join 
					tc_janal_localidades localidad_empresa on domicilio_empresa.id_localidad = localidad_empresa.id_localidad
				inner join
          tc_janal_municipios municipio_empresa on localidad_empresa.id_municipio = municipio_empresa.id_municipio
        inner join
					tc_janal_entidades  entidad_empresa on municipio_empresa.id_entidad = entidad_empresa.id_entidad
				inner join
					tc_janal_paises  pais_empresa on entidad_empresa.id_pais = pais_empresa.id_pais
				left join 
					tc_mantic_personas responsable_empresa on tc_mantic_empresas.id_responsable = responsable_empresa.id_persona
				left join 
					tr_mantic_persona_tipo_contacto telefono on responsable_empresa.id_persona = telefono.id_persona and telefono.id_tipo_contacto=1
				left join 
					tr_mantic_persona_tipo_contacto correo on telefono.id_persona = correo.id_persona and correo.id_tipo_contacto=9
				inner join 
					tc_mantic_ordenes_estatus on tc_mantic_ordenes_compras.id_orden_estatus= tc_mantic_ordenes_estatus.id_orden_estatus
				where 
        tc_mantic_ordenes_compras.id_orden_compra= {idOrdenCompra}	
      </select>
      <select id="ordenesCompra">
        select
					tc_mantic_ordenes_compras.id_orden_compra as id_key,
					tc_mantic_ordenes_compras.id_empresa,
          tc_mantic_empresas.nombre as nombre_empresa,
				  tc_mantic_empresas.clave as empresa,  
					tc_mantic_ordenes_compras.consecutivo,  
					tc_mantic_proveedores.id_proveedor,  
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_ordenes_compras.total,
				  tc_mantic_ordenes_estatus.nombre as estatus,
					tc_mantic_ordenes_compras.id_orden_estatus,
					tc_mantic_ordenes_compras.registro,
					tc_mantic_ordenes_estatus.estatus_asociados
				from 
					tc_mantic_ordenes_compras
				inner join 
					tr_mantic_proveedor_pago on tc_mantic_ordenes_compras.id_proveedor_pago= tr_mantic_proveedor_pago.id_proveedor_pago
				inner join 
					tc_mantic_proveedores on tr_mantic_proveedor_pago.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
					tc_mantic_empresas on tc_mantic_ordenes_compras.id_empresa= tc_mantic_empresas.id_empresa
				inner join 
					tc_mantic_ordenes_estatus on tc_mantic_ordenes_compras.id_orden_estatus=tc_mantic_ordenes_estatus.id_orden_estatus
				where
					tc_mantic_ordenes_compras.id_empresa in ({idEmpresa})
					and {condicion}
				{sortOrder}
      </select>
		</unit> 
    <unit id="VistaTicketVentaDto">
      <select id="ticket">
        select 
          tc_mantic_ventas.id_venta id_key,
          tc_mantic_ventas.consecutivo consecutivo_venta,
          tc_mantic_ventas.descuento descuento_venta,
          tc_mantic_ventas.extras extras_venta,
          tc_mantic_ventas.descuentos descuentos_venta,
          tc_mantic_ventas.impuestos impuestos_venta,
          tc_mantic_ventas.sub_total subtotal_venta,
          tc_mantic_ventas.total total_venta,
          tc_mantic_ventas.registro,
          tc_mantic_ventas.observaciones,
          tc_mantic_ventas_detalles.*,
        	tc_mantic_personas.cuenta,
					concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as nombre
         from 
          tc_mantic_ventas 
         inner join 
          tc_mantic_ventas_detalles on tc_mantic_ventas.id_venta = tc_mantic_ventas_detalles.id_venta
         inner join 
          tc_mantic_ventas_estatus on tc_mantic_ventas.id_venta_estatus = tc_mantic_ventas_estatus.id_venta_estatus
        inner join 
				  tc_janal_usuarios on tc_mantic_ventas.id_usuario = tc_janal_usuarios.id_usuario
				inner join				
					tc_mantic_personas on tc_mantic_personas.id_persona = tc_janal_usuarios.id_persona
         where
          tc_mantic_ventas.id_venta = {idVenta}   
         order by 
          tc_mantic_ventas.id_venta,tc_mantic_ventas_detalles.id_venta_detalle asc     
      </select>
    </unit>
    <unit id="VistaReporteNotaEntrada">
      <select i= "detalleNotaEntrada">
        select      
          tc_mantic_notas_entradas.id_sin_iva as sin_iva, 
          tc_mantic_notas_entradas.registro registro_nota_entrada,
					tc_mantic_notas_entradas.tipo_de_cambio tipo_de_cambio_nota, 
					tc_mantic_notas_entradas.observaciones observaciones_nota_entrada,
					tc_mantic_notas_entradas.sub_total sub_total_nota,
					tc_mantic_notas_entradas.total total_final,
					tc_mantic_notas_entradas.impuestos impuestos_nota,
					tc_mantic_notas_entradas.descuentos descuentos_nota,
					tc_mantic_notas_entradas.descuento descuento_nota,
					tc_mantic_notas_entradas.extras extas_notas,
					tc_mantic_notas_entradas.factura factura_nota,
					tc_mantic_notas_entradas.fecha_factura,
					tc_mantic_notas_entradas.fecha_recepcion,
					tc_mantic_notas_entradas.consecutivo consecutivo_padre, 
					tc_mantic_notas_entradas.registro registro_nota,
					tc_mantic_articulos.nombre, 
					tc_mantic_notas_detalles.sat, 
					tc_mantic_notas_detalles.codigo, 
					tc_mantic_notas_detalles.costo, 
					(tc_mantic_notas_detalles.costo- (tc_mantic_notas_detalles.descuentos/ tc_mantic_notas_detalles.cantidad)) as valor, 
					tc_mantic_notas_detalles.descuento, 
					tc_mantic_notas_detalles.id_nota_entrada, 
					tc_mantic_notas_detalles.extras, 
					tc_mantic_notas_detalles.importe, 
					tc_mantic_notas_entradas.total, 
					(select tc_mantic_articulos_codigos.codigo from tc_mantic_articulos_codigos where tc_mantic_articulos_codigos.id_articulo= tc_mantic_articulos.id_articulo and tc_mantic_articulos_codigos.id_principal= 1) as propio,
					tc_mantic_notas_detalles.iva, 
					tc_mantic_notas_detalles.impuestos, 
					tc_mantic_notas_detalles.descuentos, 
					tc_mantic_notas_detalles.sub_total, 
					0 as cantidad, 
					tc_mantic_notas_detalles.cantidades as solicitados, 
					tc_mantic_notas_detalles.id_nota_detalle, 
					tc_mantic_notas_detalles.id_articulo, 
					tc_mantic_notas_detalles.descuentos, 
					tc_mantic_notas_entradas.id_proveedor, 
					false as ultimo, 
					false as solicitado, 
					0 as stock,
				  tc_mantic_notas_detalles.excedentes
        from      
          tc_mantic_notas_entradas
        inner join      
          tc_mantic_notas_detalles on tc_mantic_notas_entradas.id_nota_entrada= tc_mantic_notas_detalles.id_nota_entrada
        inner join
          tc_mantic_articulos on tc_mantic_notas_detalles.id_articulo= tc_mantic_articulos.id_articulo
        where      
          tc_mantic_notas_entradas.id_nota_entrada = {idNotaEntrada}
				  and tc_mantic_notas_detalles.cantidades&lt;&gt; 0
				order by
				  tc_mantic_notas_detalles.registro		
      </select>
    </unit>
  </dml>
</process>
