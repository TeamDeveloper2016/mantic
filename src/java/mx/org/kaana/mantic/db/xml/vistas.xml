<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
		Relación de consultas para las vistas de MANTIC
-->
<process>
	<dml> 
		<unit id="VistaArticulosDto">
			<select id="row">
				select 
				  tc_mantic_articulos.id_articulo as id_key,
				  tc_mantic_articulos.nombre,          
				  tc_mantic_articulos.menudeo,          
				  tc_mantic_articulos.medio_mayoreo,          
				  tc_mantic_articulos.mayoreo,          
				  tc_mantic_articulos.stock,       
				  tc_mantic_articulos.iva,          
				  tc_mantic_articulos.desperdicio          
				from 
					tc_mantic_articulos
				inner join
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo = tc_mantic_articulos_codigos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa
				inner join
					tr_mantic_empaque_unidad_medida on tc_mantic_articulos.id_empaque_unidad_medida = tr_mantic_empaque_unidad_medida.id_unidad_medida
				inner join 
					tc_mantic_empaques on tr_mantic_empaque_unidad_medida.id_empaque = tc_mantic_empaques.id_empaque
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where 
					tc_mantic_empresas.id_empresa = {idEmpresa}
				and 
					upper(tc_mantic_articulos_codigos.codigo) like upper('%{codigo}%')
				and 
					upper(tc_mantic_articulos.nombre) like upper('%{nombre}%')				
				group by 
				  tc_mantic_articulos.nombre,          
				  tc_mantic_articulos.menudeo,          
				  tc_mantic_articulos.medio_mayoreo,          
				  tc_mantic_articulos.mayoreo,          
				  tc_mantic_articulos.stock,          
				  tc_mantic_articulos.iva,          
				  tc_mantic_articulos.desperdicio          
				{sortOrder}
			</select>
		</unit>
		<unit id="VistaEmpaqueUnidadMedidaDto">
			<select id="empaqueUnidadMedida">
				select 
					tr_mantic_empaque_unidad_medida.id_empaque_unidad_medida as id_key,
					tc_mantic_unidades_medidas.nombre,
					tc_mantic_unidades_medidas.clave,
					tc_mantic_unidades_medidas.descripcion,
					tc_mantic_unidades_medidas.proporcion
				from
				  tr_mantic_empaque_unidad_medida
				inner join 
					tc_mantic_unidades_medidas on tr_mantic_empaque_unidad_medida.id_unidad_medida = tc_mantic_unidades_medidas.id_unidad_medida
				where 
					id_empaque= {idEmpaque}
			</select>
		</unit>
        <unit id="VistaProveedoresDto">
          <select id="row">
            select 
              tc_mantic_proveedores.id_proveedor as id_key,
              tc_mantic_proveedores.clave,
              tc_mantic_proveedores.rfc,
              tc_mantic_proveedores.razon_social,
              tc_mantic_tipos_proveedores.nombre as tipo_proveedor,
              tc_mantic_proveedores.dias_entrega,
              tc_mantic_tipos_dias.nombre as tipo_dia,
              tc_mantic_proveedores.descuento  
             from   
               tc_mantic_proveedores
             inner join
               tc_mantic_tipos_proveedores   on  tc_mantic_tipos_proveedores.id_tipo_proveedor= tc_mantic_proveedores.id_tipo_proveedor
             inner  join
               tc_mantic_tipos_dias  on tc_mantic_tipos_dias.id_tipo_dia=tc_mantic_proveedores.id_tipo_dia             
             where
               tc_mantic_proveedores.razon_social like '%{razonSocial}%'
              and
               (tc_mantic_proveedores.rfc like '%{rfc}%' or tc_mantic_proveedores.rfc is null)
              and
               tc_mantic_proveedores.clave like '%{clave}%'
              and 
                tc_mantic_proveedores.id_tipo_proveedor  in ({idTipoProveedor}) 
              and
                tc_mantic_proveedores.id_empresa={idEmpresa}            
              {sortOrder}
          </select>
          <select id="proveedorCondicionPago">
            select 
                tc_mantic_tipos_pagos.id_tipo_pago,
                tc_mantic_tipos_pagos.id_tipo_pago as id_key,            
                tc_mantic_tipos_pagos.nombre as nombre_pago,
                tc_mantic_tipos_formas_pagos.clave,
                tc_mantic_tipos_formas_pagos.nombre
            from 
              tc_mantic_tipos_pagos
            inner join 
              tc_mantic_tipos_formas_pagos on tc_mantic_tipos_formas_pagos.id_tipo_medio_pago=tc_mantic_tipos_pagos.id_tipo_medio_pago              
          </select>  
           <select id="direccionProveedor">
            select 
            tc_janal_entidades.id_entidad,tc_janal_municipios.id_municipio,tc_janal_localidades.id_localidad, tc_janal_entidades.id_entidad as id_key
          from 
            tc_janal_entidades 
          inner join
            tc_janal_municipios  on tc_janal_municipios.id_entidad=tc_janal_entidades.id_entidad
          inner join    
            tc_janal_localidades on tc_janal_localidades.id_municipio=tc_janal_municipios.id_municipio
           inner join
            tc_mantic_domicilios on tc_mantic_domicilios.id_localidad=tc_janal_localidades.id_localidad
           where 
            tc_mantic_domicilios.id_domicilio={idDomicilio}
          </select>            
        </unit> 
        <unit id="VistaClientesDto"> 
          <select id="row">
             select 
                tc_mantic_clientes.id_cliente as id_key,
                tc_mantic_clientes.clave,
                tc_mantic_clientes.rfc,
                tc_mantic_clientes.razon_social,
                tc_mantic_clientes.limite_credito,
                tc_mantic_clientes.plazo_dias,
                tc_mantic_domicilios.calle,
                tc_mantic_domicilios.numero_exterior,
                tc_mantic_domicilios.asentamiento,
                tc_mantic_domicilios.codigo_postal  
               from
                 tc_mantic_clientes 
                inner join
                  tr_mantic_cliente_domicilio  on tr_mantic_cliente_domicilio.id_cliente=tc_mantic_clientes.id_cliente
                inner join
                  tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio = tr_mantic_cliente_domicilio.id_domicilio
                where   
                 tc_mantic_clientes.razon_social like '%{razonSocial}%'
                and
                  tc_mantic_clientes.rfc like '%{rfc}%'
                and
                  tc_mantic_clientes.clave like '%{clave}%' 
                 and
                  tc_mantic_clientes.id_empresa={idEmpresa} 
                 and 
                  tr_mantic_cliente_domicilio.id_principal={idPrincipal}            
               {sortOrder}            
          </select>
         
        </unit>
        <unit id="VistaAlmacenesDto">
          <select id="row">
            select 
             tc_mantic_almacenes.id_almacen as id_key,
             tc_mantic_almacenes.clave,
             tc_mantic_almacenes.nombre,
             tc_mantic_almacenes.descripcion,
             tc_mantic_personas.nombres,
             tc_mantic_personas.paterno,
             tc_mantic_personas.materno,
             tc_mantic_domicilios.calle,
             tc_mantic_domicilios.numero_exterior,
             tc_mantic_domicilios.asentamiento,
             tc_mantic_domicilios.codigo_postal,
             tc_janal_entidades.descripcion as entidad,
             tc_janal_municipios.descripcion as municipio,
             (select count(*) from tc_mantic_almacenes_pisos where id_almacen=tc_mantic_almacenes.id_almacen) pisos            
           from 
             tc_mantic_almacenes
           inner join
             tc_mantic_personas on tc_mantic_personas.id_persona=tc_mantic_almacenes.id_responsable
           inner join
             tr_mantic_almacen_domicilio on  tr_mantic_almacen_domicilio.id_almacen= tc_mantic_almacenes.id_almacen
           inner join
            tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio = tr_mantic_almacen_domicilio.id_domicilio
           inner join
             tc_janal_localidades  on tc_mantic_domicilios.id_localidad=tc_janal_localidades.id_localidad
           inner join 
             tc_janal_municipios on tc_janal_municipios.id_municipio= tc_janal_localidades.id_municipio
            inner join
              tc_janal_entidades  on tc_janal_municipios.id_entidad=tc_janal_entidades.id_entidad
             where
              (tc_mantic_almacenes.clave like '%{clave}%' or tc_mantic_almacenes.clave is null)
             and
               tc_mantic_almacenes.nombre like '%{nombre}%'
              and 
                (tc_mantic_almacenes.descripcion  like '%{descripcion}%' or  tc_mantic_almacenes.descripcion is null)
              and
                tr_mantic_almacen_domicilio.id_principal={idPrincipal}  
              and
                  tc_mantic_almacenes.id_empresa={idEmpresa} 
             {sortOrder} 
          </select>  
        </unit>
		<unit id="VistaPersonasDto">
			<select id="row">
				select 
				  tc_mantic_personas.id_persona as id_key,
				  tc_mantic_personas.nombres,
				  tc_mantic_personas.paterno,
				  tc_mantic_personas.materno,
				  tc_mantic_personas.rfc,
				  tc_mantic_personas.curp,
				  tc_mantic_personas.fecha_nacimiento,
				  tc_mantic_tipos_personas.nombre as tipo_persona,
				  tc_janal_tipos_sexos.id_tipo_sexo,
		 		  tc_janal_tipos_sexos.nombre as sexo,
				  tc_janal_tipos_sexos.nombre,
				  tc_mantic_personas.cuenta 
				from 
					tc_mantic_personas
				inner join
					tr_mantic_empresa_personal on tc_mantic_personas.id_persona = tr_mantic_empresa_personal.id_persona
				inner join
					tc_mantic_personas_titulos on tc_mantic_personas_titulos.id_persona_titulo =tc_mantic_personas.id_persona_titulo
				inner join
					tc_mantic_tipos_personas  on tc_mantic_personas.id_tipo_persona=tc_mantic_tipos_personas.id_tipo_persona
				inner join
					tc_janal_tipos_sexos  on tc_janal_tipos_sexos.id_tipo_sexo = tc_mantic_personas.id_tipo_sexo
				where 
					(tc_mantic_personas.nombres like '%{nombres}%' 
				or
					tc_mantic_personas.paterno like '%{paterno}%'
				or
					tc_mantic_personas.materno  like '%{materno}%')
				and 
					tc_mantic_personas.rfc  like '%{rfc}%'
				and 
					tc_mantic_personas.id_tipo_sexo in ({idTipoSexo})
				and
					tc_mantic_personas.id_tipo_persona  in ({idTipoPersona})
				and 
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}
				{sortOrder}  
			</select>              
			<select id="tipoPersona">
				select 
					tc_mantic_personas.*,tc_mantic_personas.id_persona as id_key
				from
					tc_mantic_personas
				inner join
					tr_mantic_empresa_personal on tc_mantic_personas.id_persona = tr_mantic_empresa_personal.id_persona
				where 
					tc_mantic_personas.id_tipo_persona= {idTipoPersona}
				and 
					tr_mantic_empresa_personal.id_empresa= {idEmpresa}
				order by
					paterno,materno,nombres
			</select>
    </unit>        
		<unit id="VistaGruposClientesDto">
			<select id="row">
				select      
					tc_mantic_grupos.id_grupo as id_key,
					tc_mantic_grupos.nombre,
					tc_mantic_grupos.registro
				from      
					tc_mantic_grupos
				inner join
					tc_mantic_grupos_clientes on tc_mantic_grupos.id_grupo= tc_mantic_grupos_clientes.id_grupo
				where      
					tc_mantic_grupos.nombre like '%{nombre}%' 
					or tc_mantic_grupos_clientes.id_cliente= {idCliente}
				group by
					tc_mantic_grupos.id_grupo,
					tc_mantic_grupos.nombre,
					tc_mantic_grupos.registro
				order by  
					tc_mantic_grupos.nombre
			</select>
		</unit>
		<unit id="VistaOrdenesComprasDto">
			<select id="row">
				select
					tc_mantic_ordenes_compras.id_orden_compra as id_key,
					tc_mantic_ordenes_compras.id_empresa,  
				  tc_mantic_empresas.clave as empresa,  
					tc_mantic_ordenes_compras.consecutivo,  
					tc_mantic_proveedores.id_proveedor,  
					tc_mantic_proveedores.razon_social as proveedor,
					tc_mantic_ordenes_compras.total,
				  tc_mantic_compras_estatus.nombre as estatus,
					tc_mantic_ordenes_compras.id_compra_estatus,
					tc_mantic_ordenes_compras.registro
				from 
					tc_mantic_ordenes_compras
				inner join 
					tr_mantic_proveedor_pago on tc_mantic_ordenes_compras.id_proveedor_pago= tr_mantic_proveedor_pago.id_proveedor_pago
				inner join 
					tc_mantic_proveedores on tr_mantic_proveedor_pago.id_proveedor= tc_mantic_proveedores.id_proveedor
				inner join 
					tc_mantic_ordenes_detalles on tc_mantic_ordenes_compras.id_orden_compra= tc_mantic_ordenes_detalles.id_orden_compra
				inner join 
					tc_mantic_empresas on tc_mantic_ordenes_compras.id_empresa= tc_mantic_empresas.id_empresa
				inner join 
					tc_mantic_compras_estatus on tc_mantic_ordenes_compras.id_compra_estatus= tc_mantic_compras_estatus.id_compra_estatus
				where
					tc_mantic_ordenes_compras.id_empresa= {idEmpresa}
					or tc_mantic_ordenes_compras.consecutivo like '%{consecutivo}%'
					or tc_mantic_proveedores.id_proveedor = {idProveedor}
					or (date_format(tc_mantic_ordenes_compras.registro, '%Y%c%d')&gt;= '{fechaInicio}' and date_format(tc_mantic_ordenes_compras.registro, '%Y%c%d')&lt;= '{fechaTermino}')
					or tc_mantic_ordenes_compras.id_compra_estatus= {idCompraEstatus}
					or tc_mantic_ordenes_compras.id_orden_compra= {idOrdenCompra}
				group by
					tc_mantic_ordenes_compras.id_orden_compra,
					tc_mantic_ordenes_compras.id_empresa, 
					tc_mantic_empresas.clave,   
					tc_mantic_ordenes_compras.consecutivo,  
					tc_mantic_proveedores.id_proveedor,  
					tc_mantic_proveedores.razon_social,
					tc_mantic_compras_estatus.nombre,
					tc_mantic_ordenes_compras.id_compra_estatus,
					tc_mantic_ordenes_compras.registro
				{sortOrder}
			</select>
			<select id="ultimoPrecio">
        select      
          tc_mantic_ordenes_detalles.id_orden_detalle as id_key,
          tc_mantic_ordenes_compras.tipo_de_cambio,
          tc_mantic_ordenes_detalles.costo,
          tc_mantic_ordenes_detalles.cantidad,
          tc_mantic_ordenes_detalles.descuento,
          tc_mantic_ordenes_detalles.extras,
          tc_mantic_ordenes_detalles.registro
        from      
          tc_mantic_ordenes_detalles
				inner join 
					tc_mantic_ordenes_compras on tc_mantic_ordenes_detalles.id_orden_compra= tc_mantic_ordenes_compras.id_orden_compra
        where      
          id_articulo = {idArticulo}
        order by
          tc_mantic_ordenes_detalles.registro desc				
			</select>
			<select id="preciosSegerido">
        select      
          tr_mantic_articulo_precio_sugerido.id_articulo_precio_sugerido as id_key,        
          tc_mantic_proveedores.clave as clave_proveedor,
          tc_mantic_proveedores.razon_social as proveedor,
          tr_mantic_articulo_precio_sugerido.precio,
          tr_mantic_articulo_precio_sugerido.descuento,
          tr_mantic_articulo_precio_sugerido.observaciones,
          tr_mantic_articulo_precio_sugerido.id_leido
        from      
          tr_mantic_articulo_precio_sugerido
				inner join 
					tc_mantic_proveedores on tr_mantic_articulo_precio_sugerido.id_proveedor= tc_mantic_proveedores.id_proveedor
        where      
          id_articulo = {idArticulo}
				order by
				  tr_mantic_articulo_precio_sugerido.registro				
			</select>
			<select id="articulo">
        select 
          tc_mantic_articulos_codigos.id_articulo_codigo as id_key,
				  tc_mantic_articulos.id_articulo,
				  tc_mantic_articulos_codigos.codigo,
				  tc_mantic_articulos_codigos.id_principal,
				  tc_mantic_articulos_codigos.id_proveedor,
				  tc_mantic_articulos.nombre,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.iva
				from 
					tc_mantic_articulos
				inner join
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo = tc_mantic_articulos_codigos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa
				where 
					tc_mantic_empresas.id_empresa in ({sucursales})
				  and (
				    (tc_mantic_articulos.id_articulo= {idArticulo} and tc_mantic_articulos_codigos.id_principal= 1)
				    or
				    (tc_mantic_articulos.id_articulo= {idArticulo} and tc_mantic_articulos_codigos.id_proveedor= {idProveedor})	
				   ) 			
				order by 
				  tc_mantic_articulos_codigos.codigo,
				  tc_mantic_articulos_codigos.id_proveedor				
			</select>
			<select id="codigos">
				select 
				  tc_mantic_articulos_codigos.id_articulo_codigo as id_key,
				  tc_mantic_articulos.id_articulo,
				  tc_mantic_articulos_codigos.codigo,
				  tc_mantic_articulos_codigos.id_principal,
				  tc_mantic_articulos_codigos.id_proveedor,
				  tc_mantic_articulos.nombre,
				  tc_mantic_articulos.precio,
				  tc_mantic_articulos.iva,
				  tc_mantic_articulos.id_redondear
				from 
					tc_mantic_articulos
				inner join
					tc_mantic_articulos_codigos on tc_mantic_articulos.id_articulo = tc_mantic_articulos_codigos.id_articulo
				inner join 
					tc_mantic_empresas on tc_mantic_articulos.id_empresa = tc_mantic_empresas.id_empresa
				where 
					tc_mantic_empresas.id_empresa in ({sucursales})
				  and (
				    (upper(tc_mantic_articulos_codigos.codigo) like upper('%{codigo}%') and tc_mantic_articulos_codigos.id_principal= 1)
				    or 
				    upper(tc_mantic_articulos.nombre) like upper('%{codigo}%')
				    or
				    (upper(tc_mantic_articulos_codigos.codigo) like upper('%{codigo}%') and tc_mantic_articulos_codigos.id_proveedor= {idProveedor})	
				   ) 			
				order by 
				  tc_mantic_articulos.nombre
			</select>
			<select id="siguiente">
        select
					max(orden)+ 1 as siguiente
				from 
					tc_mantic_ordenes_compras
				where
				  ejercicio= {ejercicio} 
				  and id_empresa= {idEmpresa}				
			</select>
			<select id="proveedores">
        select
					tc_mantic_proveedores.id_proveedor as id_key,
					tc_mantic_proveedores.clave,  
					tc_mantic_proveedores.razon_social as nombre,
					tc_mantic_proveedores.dias_entrega
				from 
					tc_mantic_ordenes_compras
				inner join
						tr_mantic_proveedor_pago on tc_mantic_ordenes_compras.id_proveedor_pago= tr_mantic_proveedor_pago.id_proveedor_pago
				inner join
						tc_mantic_proveedores on tr_mantic_proveedor_pago.id_proveedor= tc_mantic_proveedores.id_proveedor       
				where 		
				  tc_mantic_ordenes_compras.id_empresa in ({sucursales})
				group by
          tc_mantic_proveedores.id_proveedor,
					tc_mantic_proveedores.clave,  
					tc_mantic_proveedores.razon_social,
					tc_mantic_proveedores.dias_entrega			
				order by
				  tc_mantic_proveedores.clave
			</select>
			<select id="condiciones">
        select      
				  tr_mantic_proveedor_pago.id_proveedor_pago as id_key,
          tr_mantic_proveedor_pago.id_proveedor,
          tr_mantic_proveedor_pago.clave,
          tr_mantic_proveedor_pago.descuento,
          tr_mantic_proveedor_pago.id_tipo_pago,
          tc_mantic_tipos_compras.id_tipo_compra,
          tc_mantic_tipos_compras.nombre,
          tr_mantic_proveedor_pago.observaciones
        from      
          tr_mantic_proveedor_pago
        inner join 
          tc_mantic_tipos_compras on tr_mantic_proveedor_pago.id_tipo_compra= tc_mantic_tipos_compras.id_tipo_compra
        where      
          tr_mantic_proveedor_pago.id_proveedor = {idProveedor}
				order by
				  tr_mantic_proveedor_pago.clave				
			</select>	
			<select id="moneda">
        select      
					tc_mantic_proveedores.id_proveedor as id_key,
          tc_mantic_proveedores.*,
          tc_mantic_tipos_monedas.nombre as moneda,
          tc_mantic_tipos_monedas.siglas,
          tc_mantic_tipos_monedas.simbolo,
          tc_mantic_tipos_proveedores.nombre as tipo_proveedor,
          tc_mantic_tipos_proveedores.dias,
          tc_mantic_tipos_dias.nombre as tipo_dia
        from      
          tc_mantic_proveedores
        inner join 
          tc_mantic_tipos_monedas on tc_mantic_proveedores.id_tipo_moneda= tc_mantic_tipos_monedas.id_tipo_moneda
        inner join 
          tc_mantic_tipos_proveedores on tc_mantic_proveedores.id_tipo_proveedor= tc_mantic_tipos_proveedores.id_tipo_proveedor
        inner join 
          tc_mantic_tipos_dias on tc_mantic_proveedores.id_tipo_dia= tc_mantic_tipos_dias.id_tipo_dia
        where 
          tc_mantic_proveedores.id_empresa in ({sucursales})
				order by
				  tc_mantic_proveedores.clave
			</select>
		</unit>
		<unit id="VistaDomiciliosCatalogosDto">
			<select id="domicilios">
				select 
          tc_mantic_domicilios.id_domicilio as id_key,
          tc_mantic_domicilios.*,
          concat(tc_janal_entidades.descripcion,' , ',calle,' ',numero_exterior,' ',asentamiento) as domicilio,          
          tc_janal_localidades.clave as clave_localidad,
          tc_janal_localidades.descripcion as localidad,
          tc_janal_municipios.id_municipio,
          tc_janal_municipios.clave as clave_municipio,
          tc_janal_municipios.descripcion as municipio,
          tc_janal_entidades.id_entidad,
          tc_janal_entidades.clave as clave_entidad,
          tc_janal_entidades.descripcion as entidad
        from 
          tc_mantic_domicilios
        inner join 
          tc_janal_localidades on tc_mantic_domicilios.id_localidad = tc_janal_localidades.id_localidad
        inner join
          tc_janal_municipios on tc_janal_localidades.id_municipio = tc_janal_municipios.id_municipio
        inner join 
          tc_janal_entidades on tc_janal_municipios.id_entidad = tc_janal_entidades.id_entidad
        where 
          {condicion}
        order by 
          tc_janal_entidades.clave,
          tc_janal_municipios.clave,
          tc_janal_localidades.clave,
          tc_mantic_domicilios.codigo_postal
			</select>
		</unit>
	</dml>    
</process>
