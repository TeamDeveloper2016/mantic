<?xml version="1.0" encoding="ISO-8859-1"?>
<!--
		Relación de consultas para las vistas de IMOX
-->
<process>
	<dml> 
    <unit id="VistaClientesCitasDto">
      <select id="lazy">
select
  tc_kalan_citas.id_cita as id_key,
  tc_kalan_citas.id_cliente,
  tc_mantic_clientes.clave,
  tc_mantic_clientes.rfc,
  concat(tc_mantic_clientes.razon_social, ' ', ifnull(tc_mantic_clientes.paterno, ''), ' ', ifnull(tc_mantic_clientes.materno, '')) as cliente,
  tc_kalan_citas.consecutivo,
  tc_kalan_citas.id_cita_estatus,
  tc_kalan_citas.inicio,
  tc_kalan_citas.termino,
  tc_kalan_citas.recordatorio,
  tc_mantic_clientes.limite_credito as credito,
  tc_mantic_clientes.saldo,
  ' ' as motivo, 
  tc_kalan_citas_estatus.nombre as estatus,
  concat(tc_mantic_personas.nombres, ' ', tc_mantic_personas.paterno, ' ', tc_mantic_personas.materno) as usuario,      
  tc_kalan_citas.registro
from
  tc_kalan_citas
inner join
  tc_mantic_clientes on tc_kalan_citas.id_cliente= tc_mantic_clientes.id_cliente
inner join
  tc_kalan_citas_estatus on tc_kalan_citas.id_cita_estatus= tc_kalan_citas_estatus.id_cita_estatus
inner join
  tc_janal_usuarios on tc_kalan_citas.id_usuario= tc_janal_usuarios.id_usuario          
inner join
  tc_mantic_personas on tc_janal_usuarios.id_persona= tc_mantic_personas.id_persona
where
  {condicion}   
{sortOrder}             
      </select>
      <select id="nombre">
select
  tc_kalan_citas.id_cita as id_key,
  tc_kalan_citas.id_cliente,
  tc_mantic_clientes.clave,
  tc_mantic_clientes.rfc,
  concat(tc_mantic_clientes.razon_social, ' ', ifnull(tc_mantic_clientes.paterno, ''), ' ', ifnull(tc_mantic_clientes.materno, '')) as cliente,
  tc_kalan_citas.recordatorio,
  tc_kalan_citas.id_cita_estatus,
  tc_kalan_citas_estatus.nombre as estatus
from
  tc_kalan_citas
inner join
  tc_mantic_clientes on tc_kalan_citas.id_cliente= tc_mantic_clientes.id_cliente
inner join
  tc_kalan_citas_estatus on tc_kalan_citas.id_cita_estatus= tc_kalan_citas_estatus.id_cita_estatus
where
  {condicion}
order by
  tc_mantic_clientes.razon_social, 
  tc_mantic_clientes.paterno, 
  tc_mantic_clientes.materno
      </select>
      <select id="clientes">
select      
  tc_mantic_clientes.id_cliente as id_key,
  tc_mantic_clientes.*,
  concat(tc_mantic_clientes.razon_social, ' ', ifnull(tc_mantic_clientes.paterno, ''), ' ', ifnull(tc_mantic_clientes.materno, '')) as cliente,
	concat(ifnull(tc_mantic_domicilios.calle, ''), ' #', ifnull(tc_mantic_domicilios.numero_exterior, ''), ',', ifnull(tc_mantic_domicilios.asentamiento, ''), ',', ifnull(tc_mantic_domicilios.codigo_postal, '')) as domicilio
from      
  tc_mantic_clientes
left join
  tr_mantic_cliente_domicilio on tr_mantic_cliente_domicilio.id_cliente= tc_mantic_clientes.id_cliente 
  and tr_mantic_cliente_domicilio.id_tipo_domicilio= 1 
  and tr_mantic_cliente_domicilio.id_principal= 1
left join
  tc_mantic_domicilios on tc_mantic_domicilios.id_domicilio= tr_mantic_cliente_domicilio.id_domicilio
where 
  id_empresa in ({sucursales})
  and {condicion}
order by
  tc_mantic_clientes.razon_social, 
  tc_mantic_clientes.paterno, 
  tc_mantic_clientes.materno
      </select>
    </unit>    
	</dml>    
</process>
