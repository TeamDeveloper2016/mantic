<?xml version="1.0" encoding="ISO-8859-1"?>
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml"
      xmlns:h="http://java.sun.com/jsf/html"
      xmlns:p="http://primefaces.org/ui"
      xmlns:f="http://java.sun.com/jsf/core"
			xmlns:ui="http://java.sun.com/jsf/facelets">	
    <h:outputScript library="janal" name="#{kajoolUtilAplicacion.preciosJs}"/>
  <script type="text/javascript">
    $(function() {
      janal.fecha();
      $('#banner').addClass('ui-panelgrid');
      $('#banner').addClass('ui-widget');
      $('#banner tr:eq(0)').addClass('ui-widget-content');
    });
		
    $(document).ready(function() {
     jsPrecios= new Janal.Control.Precios.Core();
    });			
  </script>
  <div class="ui-grid ui-grid-responsive" style="overflow-y:hidden;">
    <div class="ui-grid-row janal-grid-row">
			<div style="width: 4% !important; text-align: center">
				<p:graphicImage library="janal" name="img/sistema/bonanza.svg" styleClass="janal-logo-mini" width="30"/>
			</div>	
  		<div class="ui-grid-col-12">
				<div class="ui-grid-row janal-grid-row">
					<div class="ui-grid-col-8 lg-pantalla">
						<h1 class="titulo-proyecto janal-header-title">#{sessionScope.autentifica.empresa.nombre}</h1>
					</div>
					<div class="ui-grid-col-8 xs-pantalla">
						<h1 class="janal-header-title">#{kajoolUtilAplicacion.tituloCorto}</h1>
					</div>
					<div class="ui-grid-col-4 lg-pantalla">
					</div>  
					<div class="ui-grid-col-4 xs-pantalla">
					</div>
				</div>
				<div class="ui-grid-row janal-grid-rows">
					<div class="ui-grid-col-4 margin-fecha">
						<span id="reloj" class="fecha janal-text-one-line lg-pantalla"></span>
						<span class="fecha janal-text-one-line xs-pantalla Fs14">#{kajoolUtilAplicacion.currentDate}</span>
					</div>
					<div class="ui-grid-col-4 margin-desarrollo" style="text-align: center;">
						<p:outputLabel styleClass="janal-etapa lg-pantalla" value="#{kajoolUtilAplicacion.servidorEspecial}"/>
						<p:outputLabel styleClass="janal-etapa xs-pantalla Fs14" value="#{kajoolUtilAplicacion.servidorEspecial}"/>
					</div>
					<div class="ui-grid-col-4 margin-version" style="text-align: right;">
						<span id="version" class="version lg-pantalla">#{kajoolUtilAplicacion.versionAplicacion}</span>
						<span id="version" class="version xs-pantalla Fs14">#{kajoolUtilAplicacion.version}</span>
					</div>
				</div>
			</div>
		</div>	
	</div>
	<div id="sticky-menu" class="ui-panel ui-widget ui-widget-content ui-corner-all janal-content-header Responsive100">
		<ui:include src="/WEB-INF/plantillas/secciones/header.xhtml"/>
		<ui:include src="/WEB-INF/plantillas/secciones/calculadora.xhtml"/>
		<div class="ui-panel-titlebar ui-widget-header ui-corner-all janal-menu-header" style="display: -webkit-box;">
			<span class="ui-panel-title Fs18 lg-pantalla">
				#{titulo}
			</span>
			<span class="ui-panel-title Fs16 xs-pantalla">
				#{kajoolUtilAplicacion.toTitle(titulo, 35)}
			</span>
		</div>
		<div class="janal-icon-ajax">
			<p:ajaxStatus style="width:16px; height:16px;">
				<f:facet name="start">
					<i class="fa fa-spinner fa-spin fa-2x"/>
				</f:facet>
				<f:facet name="complete">
					<h:outputText value="" />
				</f:facet>
			</p:ajaxStatus>
		</div>
	</div>
  <p:notificationBar id="lockNotification" position="top" effect="slide" styleClass="jana-bar-top" widgetVar="notification" effectSpeed="slow">
    <span title="Cerrar" style="position: absolute; top: 10px; right: 80px; cursor: pointer;" onclick="PF('notification').hide();"><i class="fa fa-lg fa-close"/></span>
    <p:panelGrid layout="grid" columns="2" columnClasses="janal-wid-col-200">
      <h:outputText value="Aplicación MANTIC" styleClass="Fs20"/>
      <h:outputText value="#{kajoolUtilAplicacion.notificacion}" escape="false" styleClass="Fs14"/>
    </p:panelGrid>
  </p:notificationBar>
  <p:notificationBar id="cajaNotification" position="top" effect="slide" styleClass="jana-bar-top" widgetVar="retiroEfectivo" effectSpeed="slow">
    <span title="Cerrar" style="position: absolute; top: 10px; right: 80px; cursor: pointer;" onclick="PF('retiroEfectivo').hide();"><i class="fa fa-lg fa-close"/></span>
    <p:panelGrid layout="grid" columns="1" columnClasses="janal-wid-col-250, janal-wid-70">
      <h:outputText value="Cajas que superan el limite de efectivo permitido:" styleClass="Fs20"/>
      <h:outputText value="#{kajoolAccesoAlerta.checkCaja}" escape="false" styleClass="Fs14"/>
    </p:panelGrid>
  </p:notificationBar>
	<p:idleMonitor timeout="1620000" onidle="janal.bloquear(); PF('dialogoInactivo').show(); $('#dialogo_modal').removeClass('ui-widget-overlay');  console.log('Clase ui-widget-overlay eliminada');"/>		
	<p:dialog id="dialogo" header="Inactividad" resizable="false" widgetVar="dialogoInactivo" onShow="janal.monitor(1);" closable="false">														
		<div class="alinear-derecha">														
			<h:outputText id="segundos"/>
		</div>						
		<h:panelGrid columns="1">					
			<p:spacer width="5px"/>
			<h:outputText value="La sesión terminará pronto debido a la inactividad. Para continuar esta sesión, haga clic en Aceptar."/>
			<p:spacer width="5px"/>
			<p:separator/>
		</h:panelGrid>
		<div class="alinear-derecha">
			<p:commandButton value="Aceptar" onstart="janal.monitor(0);" oncomplete="PF('dialogoInactivo').hide(); janal.desbloquear();"/>							
		</div>				
	</p:dialog>
	<p:dialog id="dialogoVerificador" widgetVar="dlgVerificador" header="Verificador de precios" onShow="$('#verificadorValue').val('.*.');verificadorLookup();$('#verificadorValue').focus();" onHide="janal.sendLastFocus();" height="550px" width="950px" resizable="false" closeOnEscape="true">
		<h:form prependId="false">
  		<p:remoteCommand name="verificadorLookup" actionListener="#{kajoolEncabezado.doChange}" process="@this verificadorBuscarPor verificadorValue" update="verificadorPrecio verificadorTabla" oncomplete="if($('#verificadorValue').val()==='.*.') $('#verificadorValue').val('');"/>
			<p:panelGrid layout="grid" columns="2" styleClass="janal-wid-100" columnClasses="janal-wid-90, janal-wid-15">
				<p:panelGrid layout="grid" columns="1" styleClass="janal-wid-100">
					<p:outputLabel for="verificadorValue" value="Código o articulo:"/>
					<p:inputText id="verificadorValue" styleClass="janal-key-precios janal-wid-100-txt" value="#{kajoolEncabezado.attrs.buscarPor}">   
						<p:ajax event="keyup" listener="#{kajoolEncabezado.doChange}" process="@this verificadorBuscarPor" update="verificadorPrecio verificadorTabla" onstart="return $('#verificadorValue').val().trim().length&gt; 1"/>
					</p:inputText>
				</p:panelGrid>	
				<p:panelGrid layout="grid" columns="1" styleClass="janal-wid-100" columnClasses="janal-column-center, janal-column-right">
					<p:outputLabel value="Buscar por código:"/>
					<p:inputSwitch id="verificadorBuscarPor" onLabel="SI" offLabel="NO" value="#{kajoolEncabezado.attrs.buscaPorCodigo}">
						<p:ajax event="change" process="@this" update="verificadorValue"/>
					</p:inputSwitch>	
				</p:panelGrid>	
			</p:panelGrid>
			<p:panel id="verificadorPrecio" header="Precios [ #{kajoolEncabezado.attrs.selected.nombre} ]" styleClass="janal-wid-100" style="display: none">
				<p:panelGrid layout="grid" columns="6" styleClass="janal-wid-100" columnClasses="janal-column-center,janal-column-center,janal-column-center,janal-column-center,janal-column-center,janal-column-center">
					<p:outputLabel value="Menudeo"/>
					<p:outputLabel value="Medio mayoreo"/>
					<p:outputLabel value="Mayoreo"/>
					<p:outputLabel value="Limite menudeo"/>
					<p:outputLabel value="Limite medio mayoreo"/>
					<p:outputLabel value="Limite mayoreo"/>
					<p:inputText styleClass="janal-column-right" value="#{kajoolEncabezado.attrs.selected.menudeo}" readonly="true"/>
					<p:inputText styleClass="janal-column-right" value="#{kajoolEncabezado.attrs.selected.medioMayoreo}" readonly="true"/>
					<p:inputText styleClass="janal-column-right" value="#{kajoolEncabezado.attrs.selected.mayoreo}" readonly="true"/>
					<p:inputText styleClass="janal-column-center" value="0 - #{kajoolEncabezado.attrs.selected.limiteMedioMayoreo}" readonly="true"/>
					<p:inputText styleClass="janal-column-center" value="#{kajoolEncabezado.attrs.selected.limiteMedioMayoreo} - #{kajoolEncabezado.attrs.selected.limiteMayoreo}" readonly="true"/>
					<p:inputText styleClass="janal-column-center" value="#{kajoolEncabezado.attrs.selected.limiteMayoreo} - #######" readonly="true"/>
  			</p:panelGrid>
				<p:outputLabel value="Existencias por almacen:" styleClass="janal-wid-100"/>
				<p:selectOneMenu value="#{kajoolEncabezado.attrs.idAlmacen}" var="item" converter="janal.convertidor.Entity" styleClass="janal-wid-98" effect="fade" filter="true" filterMatchMode="contains">
					<f:selectItems value="#{kajoolEncabezado.attrs.almacenes}"  var="element" itemValue="#{element}" itemLabel="#{element.clave} - #{element.nombre} - #{element.stock}"/>
					<p:column headerText="Clave">
						<h:outputText value="#{item.clave}"/>
					</p:column>   
					<p:column headerText="Nombre">
						<h:outputText value="#{item.nombre}"/>
					</p:column>   
					<p:column styleClass="janal-column-right" headerText="Existencias">
						<h:outputText value="#{item.stock}"/>
					</p:column>   
					<p:column headerText="Ubicación">
						<h:outputText value="#{item.ubicacion}"/>
					</p:column>   
				</p:selectOneMenu>
			</p:panel>
			<p:spacer height="3px"/>
			<p:dataTable lazy="true" id="verificadorTabla" widgetVar="widgetVerificador" var="filtro" styleClass="janal-key-registros janal-wid-100" value="#{kajoolEncabezado.lazyModel}" selection="#{kajoolEncabezado.attrs.selected}" selectionMode="single" emptyMessage="#{Constantes.NO_EXISTEN_REGISTROS}" rows="6" paginatorTemplate="#{Constantes.ICONOS_DE_PAGINACION}"  rowsPerPageTemplate="6, 4, 2" paginator="#{kajoolEncabezado.lazyModel.rowCount gt kajoolEncabezado.lazyModel.pageSize}" rowIndexVar="index" reflow="true">
				<p:ajax event="rowSelect" process="@this" update="verificadorPrecio"/>
				<p:ajax event="rowDblselect" process="@this" update="verificadorPrecio" oncomplete="jsPrecios.show();"/>
				<p:column class="MarAuto Responsive janal-wid-20">
					<f:facet name="header">
						<h:outputText value="Código"/>
					</f:facet>
					<h:outputText value="#{filtro['propio']}"/>
				</p:column>		
				<p:column class="MarAuto Responsive">
					<f:facet name="header">
						<h:outputText value="Nombre"/>
					</f:facet>
					<h:outputText value="#{filtro['nombre']}"/>
				</p:column>		
				<p:column class="janal-column-right MarAuto Responsive janal-wid-20">
					<f:facet name="header">
						<h:outputText value="Importe"/>
					</f:facet>
					<h:outputText value="#{filtro['menudeo']}"/>
				</p:column>		
				<f:facet name="footer">
					<p:outputLabel value="Total [#{kajoolEncabezado.lazyModel==null?0:kajoolEncabezado.lazyModel.rowCount}] registros"/>
				</f:facet>
			</p:dataTable>
		</h:form>
	</p:dialog>  	
	<p:commandButton id="salir" action="/Exclusiones/salir.jsf?faces-redirect=true" style="display: none"/>
</html>
