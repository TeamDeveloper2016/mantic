<?xml version="1.0" encoding="ISO-8859-1" ?>
<ui:composition xmlns="http://www.w3.org/1999/xhtml"
                xmlns:ui="http://java.sun.com/jsf/facelets"
                xmlns:h="http://java.sun.com/jsf/html"
                xmlns:f="http://java.sun.com/jsf/core"
                xmlns:c="http://java.sun.com/jsp/jstl/core"
                xmlns:p="http://primefaces.org/ui"
                xmlns:pe="http://primefaces.org/ui/extensions"
                template="/WEB-INF/plantillas/accion.xhtml">
	<ui:param name="titulo" value="#{manticInventariosDevolucionesAccion.attrs.nombreAccion} una devolucion de entrada"/>
	<ui:define name="librerias">
    <h:outputScript library="janal" name="#{kajoolUtilAplicacion.articulosJs}"/>
		<script type="text/javascript">
			Janal.Control.fields = {				 				
				'contenedorGrupos\\:consecutivo'    : {validaciones: 'requerido', mascara: 'libre'},
				'contenedorGrupos\\:idNotaEntrada'  : {validaciones: 'requerido', mascara: 'libre', grupo: 'general'},
				'contenedorGrupos\\:articulos'      : {validaciones: 'requerido|mayor({"cuanto": 0})', mascara: 'no-aplica', grupo: 'general'},			
				'contenedorGrupos\\:total'          : {validaciones: 'requerido|mayor({"cuanto": 0})', mascara: 'no-aplica', grupo: 'general'},			
				'contenedorGrupos\\:observaciones'  : {validaciones: 'libre', mascara: 'libre', formatos: 'cambiar-mayusculas', grupo: 'general', individual: true},
				'cantidades'                        : {multiple: '$', validaciones: 'mayor({"cuanto": 0})', mascara: 'libre', formatos: 'cambiar-mayusculas', grupo: 'general', individual: true}				
			};			
			
    	$(document).ready(function() {
				setTimeout("janal.readingMode('#{manticInventariosDevolucionesAccion.attrs.nombreAccion}')", 500);
        jsArticulos= new Janal.Control.Articulos.Core(#{manticInventariosDevolucionesAccion.adminOrden.articulos.size()});
      });
			
			function execute(lock) {
				var index= jsArticulos.cursor.index;
				jsArticulos.cursor.index= jsArticulos.cursor.top;
				$(jsArticulos.amount()).addClass('ignore');
				$(jsArticulos.price()).addClass('ignore');
				var ok= janal.execute(lock);
				if(!ok) {
					jsArticulos.cursor.index= index;
  				$(jsArticulos.amount()).removeClass('ignore');
	  			$(jsArticulos.price()).removeClass('ignore');
				} // if	
				return ok;
			}
		</script>   
	</ui:define>
	<ui:define name="contenido">
		<pe:remoteCommand name="refresh" process="@this @(.filas)" update="@(.filas) @(.recalculo)" actionListener="#{manticInventariosDevolucionesAccion.doCalculate}" onstart="return janal.bloquear();" oncomplete="janal.desbloquear(); jsArticulos.next();">  
			<pe:methodSignature parameters="java.lang.Integer"/>  
			<pe:methodParam name="index"/>  
		</pe:remoteCommand>		
		<div class="ui-grid ui-grid-responsive" style="overflow-y:hidden;">
			<div class="ui-grid-row janal-grid-row">
				<div class="ui-grid-col-12">
					<p:tabView id="contenedorGrupos">
            <p:ajax event="tabChange" listener="#{manticInventariosDevolucionesAccion.doTabChange}" process="@this idAlmacen idProveedor" oncomplete="jsArticulos.move();"/>						
            <p:tab title="General">							
							<p:panelGrid columns="2" layout="grid" styleClass="janal-wid-100" columnClasses="janal-wid-10, janal-wid-100">		
								<p:outputLabel for="consecutivo" value="No. devolucion:"/>
								<p:inputText id="consecutivo" styleClass="janal-wid-100-txt" value="#{manticInventariosDevolucionesAccion.adminOrden.orden.consecutivo}" readonly="true"/>
								<p:spacer width="1px"/><p:separator/>
								<p:outputLabel for="idNotaEntrada" value="No. nota:" style="display:#{empty manticInventariosDevolucionesAccion.titulo? '': 'none'}"/>
								<p:selectOneMenu id="idNotaEntrada" value="#{manticInventariosDevolucionesAccion.adminOrden.orden.ikOrdenCompra}" var="item" converter="janal.convertidor.Entity" styleClass="janal-wid-98 faltantes" effect="fade" filter="true" filterMatchMode="startsWith" style="display:#{empty manticInventariosDevolucionesAccion.titulo? '': 'none'}">
									<f:selectItems value="#{manticInventariosDevolucionesAccion.attrs.ordenes}"  var="element" itemValue="#{element.key}" itemLabel="#{element.consecutivo} #{element.razonSocial}"/>
									<p:column headerText="Clave">
										<h:outputText value="#{item.consecutivo}"/>
									</p:column>   
									<p:column headerText="Proveedor">
										<h:outputText value="#{item.razonSocial}"/>
									</p:column>   
									<p:column headerText="Estatus">
										<h:outputText value="#{item.estatus}"/>
									</p:column>   
									<p:column headerText="Total" styleClass="janal-column-right">
										<h:outputText value="#{item.total}"/>
									</p:column>   
								</p:selectOneMenu>
              </p:panelGrid>
						</p:tab>						            						            																																																
						<p:tab title="Articulos">
							<div class="ui-grid ui-grid-responsive" style="rfovelow-y:hidden;">
								<div class="ui-grid-row janal-grid-row">
									<div class="ui-grid-col-12">
										<p:dataTable id="tabla" widgetVar="kajoolTable" var="row" value="#{manticInventariosDevolucionesAccion.adminOrden.articulos}" paginator="false" reflow="true" rowKey="#{row.key}" emptyMessage=" " rowIndexVar="index" styleClass="filas">
											<p:column class="MarAuto Responsive janal-wid-3">
												<f:facet name="header">
													<h:outputText value="No."/>
												</f:facet>
												<h:outputText value="#{index+ 1}"/>
											</p:column>		
											<p:column  class="MarAuto Responsive janal-wid-13">
												<f:facet name="header">
													<h:outputText value="Código"/>
													<span class="janal-help-icon janal-help-9 fa fa-fw fa-question-circle Fright" onclick="countHelp(9);"/>	
													<pe:tooltip for="@(.janal-help-9)" showEvent="click">
														<h:outputLabel value="#{kajoolUtilAplicacion.toTextHelp(9)}" styleClass="Fs15" escape="false"/>
													</pe:tooltip>
												</f:facet>
												<div class="ui-grid-row janal-grid-row">
													<div class="ui-grid-col-12">
  	 										  	<p:inputText id="keys" value="#{row['idArticulo']}" style="display:none"/>
  	 										  	<p:inputText id="locks" value="#{row['idNotaDetalle']}" style="display:none"/>
														<p:inputText id="codigos" styleClass="janal-wid-100-txt key-down-event filas" />
													</div>	
												</div>	
											</p:column>
											<p:column class="MarAuto Responsive janal-wid-10">
												<f:facet name="header">
													<h:outputText value="Código SAT"/>
												</f:facet>
												<p:outputLabel value="#{row['sat']}"/>
												<p:inputText id="sat" value="#{row['sat']}" styleClass="janal-wid-100-txt key-event-sat fila" style="display: none"/>
											</p:column>		
											<p:column class="MarAuto Responsive janal-wid-10">
												<f:facet name="header">
													<h:outputText value="Proveedor"/>
												</f:facet>
												<p:outputLabel value="#{row['codigo']}"/>
	  									  <p:inputText id="auxiliares" value="#{row['codigo']}" styleClass="janal-wid-100-txt key-event-sat fila" style="display: none"/>
											</p:column>		
											<p:column class="MarAuto Responsive">
												<f:facet name="header">
													<h:outputText value="Articulo"/>
												</f:facet>
												<h:outputText id="nombres" value="#{row['nombre']}" title="Código propio: #{row['propio']}    Existencias almacen: #{row['stock']}" escape="false"/>
											</p:column>		
											<p:column class="cantidades janal-column-right MarAuto Responsive janal-wid-8">
												<f:facet name="header">
													<h:outputText value="Cantidad"/>
												</f:facet>
												<p:outputLabel value="#{row['cantidad']}"/>
												<p:inputText id="cantidades" value="#{row['cantidad']}" styleClass="janal-wid-100-txt janal-column-right key-focus-event  filas" onblur="janal.cantidad($('#contenedorGrupos\\:tabla\\:#{index}\\:cantidades'), '1'); jsArticulos.calculate($('#contenedorGrupos\\:tabla\\:#{index}\\:cantidades'));" style="display: none"/>
											</p:column>		
											<p:column class="precios MarAuto Responsive janal-wid-10">
												<f:facet name="header">
													<h:outputText value="Precio"/>
												</f:facet>
												<p:outputLabel value="#{row['costo']}"/>
												<p:inputText id="values" value="#{row['valor']}" style="display:none"/>
												<p:inputText id="precios" value="#{row['costo']}" styleClass="janal-wid-100-txt key-focus-event filas" onblur="janal.precio($('#contenedorGrupos\\:tabla\\:#{index}\\:precios'), '0'); jsArticulos.calculate($('#contenedorGrupos\\:tabla\\:#{index}\\:precios'));" style="display:none"/>
											</p:column>		
											<p:column class="janal-column-right MarAuto Responsive janal-wid-10">
												<f:facet name="header">
													<h:outputText value="Descuento (%)"/>
												</f:facet>
												<p:outputLabel value="#{row['descuento']}"/>
												<p:inputText id="descuentos" value="#{row['descuento']}" styleClass="janal-wid-100-txt janal-column-right key-focus-event  filas" onblur="janal.descuentos($('#contenedorGrupos\\:tabla\\:#{index}\\:descuentos'), '0'); jsArticulos.calculate($('#contenedorGrupos\\:tabla\\:#{index}\\:descuentos'));" style="display: none"/>
											</p:column>		
											<p:column class="janal-column-right MarAuto Responsive janal-wid-8">
												<f:facet name="header">
													<h:outputText value="Extras (%)"/>
												</f:facet>
												<p:outputLabel value="#{row['extras']}"/>
												<p:inputText id="extras" value="#{row['extras']}" styleClass="janal-wid-100-txt janal-column-right key-focus-event  filas" onblur="janal.descuentos($('#contenedorGrupos\\:tabla\\:#{index}\\:extras'), '0'); jsArticulos.calculate($('#contenedorGrupos\\:tabla\\:#{index}\\:extras'));" style="display: none"/>
											</p:column>		
											<p:column class="janal-column-right MarAuto Responsive janal-wid-5">
												<f:facet name="header">
													<h:outputText value="IVA"/>
												</f:facet>
												<p:outputLabel value="#{row['iva']}"/>
												<h:outputText id="ivas" value="#{row['iva']}" styleClass="janal-wid-100-txt janal-column-right" style="display: none"/>
											</p:column>		
											<p:column class="janal-column-right MarAuto Responsive janal-wid-8">
												<f:facet name="header">
													<h:outputText value="$ Importe"/>
												</f:facet>
												<p:outputLabel value="#{row['importe$']}"/>
											</p:column>		
										</p:dataTable>
										<p:spacer width="5"/>
										<div class="ui-grid-row janal-grid-row">
											<div class="ui-grid-col-2 janal-column-center">
												<p:outputLabel for="articulos" value="Articulos:"/><br/>
												<p:inputText id="articulos" value="#{manticInventariosDevolucionesAccion.adminOrden.totales.articulos}" styleClass="recalculo" style="display:none"/>
												<p:outputLabel styleClass="janal-wid-100-txt recalculo" value="#{manticInventariosDevolucionesAccion.adminOrden.totales.articulos}"/>
									    </div>	
											<div class="ui-grid-col-2 janal-column-center">
  											<p:outputLabel value="IVA:"/><br/>
												<p:outputLabel styleClass="janal-wid-100-txt recalculo" value="#{manticInventariosDevolucionesAccion.adminOrden.totales.iva$}"/>
									    </div>	
											<div class="ui-grid-col-2 janal-column-center">
											  <p:outputLabel value="Descuento:"/><br/>
											  <p:outputLabel styleClass="janal-wid-100-txt recalculo" value="#{manticInventariosDevolucionesAccion.adminOrden.totales.descuento$}"/>
									    </div>	
											<div class="ui-grid-col-2 janal-column-center">
											  <p:outputLabel value="Extra:"/><br/>
											  <p:outputLabel styleClass="janal-wid-100-txt recalculo" value="#{manticInventariosDevolucionesAccion.adminOrden.totales.extra$}"/>
									    </div>	
											<div class="ui-grid-col-2 janal-column-center">
											  <p:outputLabel value="Subtotal:"/><br/>
											  <p:outputLabel styleClass="janal-wid-100-txt recalculo" value="#{manticInventariosDevolucionesAccion.adminOrden.totales.subTotal$}"/>
									    </div>	
											<div class="ui-grid-col-2 janal-column-center ">
  											<p:outputLabel for="total" value="Total:"/><br/>
												<p:inputText id="total" value="#{manticInventariosDevolucionesAccion.adminOrden.totales.total}" styleClass="recalculo" style="display:none"/>
											  <p:outputLabel styleClass="janal-wid-100-txt recalculo" value="$ #{manticInventariosDevolucionesAccion.adminOrden.totales.total$}"/>
									    </div>	
										</div>	
									</div>									
								</div>
							</div>
						</p:tab>
						<p:tab title="Observaciones">
							<p:inputTextarea id="observaciones" rows="6" cols="33" styleClass="janal-wid-100-txt" value="#{manticInventariosDevolucionesAccion.adminOrden.orden.observaciones}"/>
						</p:tab>
					</p:tabView>
				</div>
			</div>
		</div>		
	</ui:define>    
	<ui:define name="acciones">
		<div class="lg-pantalla">
			<p:commandButton id="aceptar" value="Aceptar" icon="fa fa-check" process="@form" action="#{manticInventariosDevolucionesAccion.doAceptar}" styleClass="janal-text-white" onstart="return execute(true);" oncomplete="janal.desbloquear()"/>
			<p:commandButton id="aplicar" value="Aplicar" icon="fa fa-angle-double-down" process="@form" action="#{manticInventariosDevolucionesAccion.doAplicar}" styleClass="janal-text-white" onstart="return execute(true);" oncomplete="janal.desbloquear()" rendered="#{manticInventariosDevolucionesAccion.isAplicar}"/>
			<p:commandButton id="cancelar" value="Cancelar" icon="fa fa-close" process="@this" action="#{manticInventariosDevolucionesAccion.doCancelar}" ajax="false" styleClass="janal-text-white" onstart="janal.bloquear()" oncomplete="janal.desbloquear()"/>
		</div>		
		<div class="xs-pantalla">
			<p:commandButton id="aceptarIcon" value="Aceptar" icon="fa fa-check" process="@form" action="#{manticInventariosDevolucionesAccion.doAceptar}" styleClass="janal-text-white" onstart="return execute(true);" oncomplete="janal.desbloquear()"/>
			<p:commandButton id="cancelarIcon" value="Cancelar" icon="fa fa-close" process="@this" action="#{manticInventariosDevolucionesAccion.doCancelar}" ajax="false" styleClass="janal-text-white" onstart="janal.bloquear()" oncomplete="janal.desbloquear()"/>
		</div>		
	</ui:define>
</ui:composition>
